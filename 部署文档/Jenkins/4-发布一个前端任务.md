## 发布前端任务

### NodeJS版本配置
* 全局工作配置
  <br>![NodeJS配置](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/47.png)


### 发布一个前端任务
* 创建任务
  <br>![创建任务](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/20.png)
* 选择自由风格的软件项目
  <br>![选择自由风格的软件项目](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/40.png)
* 丢弃旧的构建
  <br>![丢弃旧的构建](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/41.png)
* 选择需要发布的分支
  <br>![选择需要发布的分支](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/42.png)
* 构建触发器
  * 不配置触发器，只能手动点击构建
  <br>![选择NodeJS版本](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/46.png)
  * 配置Git Push触发器：当master分支被push时，自动发布
  <br>![选择NodeJS版本](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/48.png)
      * GitLab配置Webhook(记得去掉ssl证书验证)
        <br>![gitlab配置webhook](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/25.png)
        <br>![gitlab配置webhook](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/29.png)    
      * GitLab测试自动构建
        <br>![gitlab测试自动构建](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/26.png)  
        <br>![gitlab测试自动构建](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/27.png)  
* 选择NodeJS版本
  <br>![选择NodeJS版本](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/43.png)
* 打包脚本
  <br>![打包脚本](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/44.png)
  * shell 脚本
    ```shell script
        npm config set registry http://registry.npm.taobao.org/
        npm install
        rm -rf dist
        npm run build
        cd dist
        rm -rf test-vue.tar.gz
        tar -zcvf test-vue.tar.gz *
        cd ../
    ```
* 发布工程配置
  <br>![打包脚本](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/45.png)
  * shell 脚本
    ```shell script
        DATE=$(date +%Y-%m-%d_%H:%M:%S)
        DOMAIN_DIR=/data/static
        BAK_DIR=$DOMAIN_DIR/bak
        if [ ! -d $BAK_DIR ];then
          echo "备份文件夹不存在，备份文件夹"   
          mkdir -p $BAK_DIR
        fi
        echo "进入工作目录:$DOMAIN_DIR"
        cd $DOMAIN_DIR
        if [ ! -d $1/ ];then
          echo "目录不存在，无需备份"
        else
          echo "备份文件"
          tar -zcvf $BAK_DIR/$1$DATE.tar.gz $1
          echo "删除旧文件"
          rm -r $1
        fi
        echo "解压新文件"
        mkdir -p $DOMAIN_DIR/$1
        tar -zxvf $1.tar.gz -C $1
        echo "删除新压缩文件"
        rm $1.tar.gz
    ```
* 构建测试
    * 点击构建
      <br>![点击构建](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/52.png)
    * 查看控制台输出
      <br>![查看控制台输出](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/53.png)
    * 查看日志
      <br>![查看日志](http://xuye-private.oss-cn-shanghai.aliyuncs.com/mackdown/Jenkins/54.png)
  